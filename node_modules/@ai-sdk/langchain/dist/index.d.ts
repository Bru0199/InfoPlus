import { BaseMessage, AIMessageChunk } from '@langchain/core/messages';
import { UIMessage, UIMessageChunk, ModelMessage, ChatTransport, ChatRequestOptions } from 'ai';
import { RemoteGraph, RemoteGraphParams } from '@langchain/langgraph/remote';

/**
 * Configuration options and helper callback methods for stream lifecycle events.
 */
interface StreamCallbacks {
    /** `onStart`: Called once when the stream is initialized. */
    onStart?: () => Promise<void> | void;
    /** `onFinal`: Called once when the stream is closed with the final completion message. */
    onFinal?: (completion: string) => Promise<void> | void;
    /** `onToken`: Called for each tokenized message. */
    onToken?: (token: string) => Promise<void> | void;
    /** `onText`: Called for each text chunk. */
    onText?: (text: string) => Promise<void> | void;
}

/**
 * Converts AI SDK UIMessages to LangChain BaseMessage objects.
 *
 * This function transforms the AI SDK's message format into LangChain's message
 * format, enabling seamless integration between the two frameworks.
 *
 * @param messages - Array of AI SDK UIMessage objects to convert.
 * @returns Promise resolving to an array of LangChain BaseMessage objects.
 *
 * @example
 * ```ts
 * import { toBaseMessages } from '@ai-sdk/langchain';
 *
 * const langchainMessages = await toBaseMessages(uiMessages);
 *
 * // Use with LangChain
 * const response = await model.invoke(langchainMessages);
 * ```
 */
declare function toBaseMessages(messages: UIMessage[]): Promise<BaseMessage[]>;
/**
 * Converts ModelMessages to LangChain BaseMessage objects.
 *
 * @param modelMessages - Array of ModelMessage objects from convertToModelMessages.
 * @returns Array of LangChain BaseMessage objects.
 */
declare function convertModelMessages(modelMessages: ModelMessage[]): BaseMessage[];
/**
 * Converts a LangChain stream to an AI SDK UIMessageStream.
 *
 * This function automatically detects the stream type and handles:
 * - Direct model streams (AsyncIterable from `model.stream()`)
 * - LangGraph streams (ReadableStream with `streamMode: ['values', 'messages']`)
 * - streamEvents streams (from `agent.streamEvents()` or `model.streamEvents()`)
 *
 * @param stream - A stream from LangChain model.stream(), graph.stream(), or streamEvents().
 * @param callbacks - Optional callbacks for stream lifecycle events.
 * @returns A ReadableStream of UIMessageChunk objects.
 *
 * @example
 * ```ts
 * // With a direct model stream
 * const model = new ChatOpenAI({ model: 'gpt-4o-mini' });
 * const stream = await model.stream(messages);
 * return createUIMessageStreamResponse({
 *   stream: toUIMessageStream(stream),
 * });
 *
 * // With a LangGraph stream
 * const graphStream = await graph.stream(
 *   { messages },
 *   { streamMode: ['values', 'messages'] }
 * );
 * return createUIMessageStreamResponse({
 *   stream: toUIMessageStream(graphStream),
 * });
 *
 * // With streamEvents
 * const streamEvents = agent.streamEvents(
 *   { messages },
 *   { version: "v2" }
 * );
 * return createUIMessageStreamResponse({
 *   stream: toUIMessageStream(streamEvents),
 * });
 * ```
 */
declare function toUIMessageStream(stream: AsyncIterable<AIMessageChunk> | ReadableStream, callbacks?: StreamCallbacks): ReadableStream<UIMessageChunk>;

/**
 * Options for configuring a LangSmith deployment transport.
 * Extends RemoteGraphParams but makes graphId optional (defaults to 'agent').
 */
type LangSmithDeploymentTransportOptions = Omit<RemoteGraphParams, 'graphId'> & {
    /**
     * The ID of the graph to connect to.
     * @default 'agent'
     */
    graphId?: string;
};
/**
 * A ChatTransport implementation for LangSmith/LangGraph deployments.
 *
 * This transport enables seamless integration between the AI SDK's useChat hook
 * and LangSmith deployed LangGraph agents.
 *
 * @example
 * ```ts
 * import { LangSmithDeploymentTransport } from '@ai-sdk/langchain';
 *
 * // Use with useChat
 * const { messages, input, handleSubmit } = useChat({
 *   transport: new LangSmithDeploymentTransport({
 *     url: 'https://your-deployment.us.langgraph.app',
 *     apiKey: 'my-api-key',
 *   }),
 * });
 * ```
 */
declare class LangSmithDeploymentTransport<UI_MESSAGE extends UIMessage> implements ChatTransport<UI_MESSAGE> {
    protected graph: RemoteGraph;
    constructor(options: LangSmithDeploymentTransportOptions);
    sendMessages(options: {
        trigger: 'submit-message' | 'regenerate-message';
        chatId: string;
        messageId: string | undefined;
        messages: UI_MESSAGE[];
        abortSignal: AbortSignal | undefined;
    } & ChatRequestOptions): Promise<ReadableStream<UIMessageChunk>>;
    reconnectToStream(_options: {
        chatId: string;
    } & ChatRequestOptions): Promise<ReadableStream<UIMessageChunk> | null>;
}

export { LangSmithDeploymentTransport, type LangSmithDeploymentTransportOptions, type StreamCallbacks, convertModelMessages, toBaseMessages, toUIMessageStream };
